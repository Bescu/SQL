-----------------------------------------------------------------------------------------------
------------------- Pour connaitre les tablespaces accessibles à un schéma --------------------
-----------------------------------------------------------------------------------------------


SELECT * FROM USER_TABLESPACES;


-----------------------------------------------------------------------------------------------
------------------------------------------- Clé primaire --------------------------------------
-----------------------------------------------------------------------------------------------

  -- pour une table 
ALTER TABLE #TABLE# ADD CONSTRAINT #TABLE#_PK PRIMARY KEY("OBJECTID") USING INDEX TABLESPACE "INDX_#G_ADT#";

  -- pour une vue
ALTER VIEW #TABLE# ADD (CONSTRAINT #TABLE#_PK PRIMARY KEY (OBJECTID) DISABLE);


-----------------------------------------------------------------------------------------------
----------------------------------- Métadonnées spatiales -------------------------------------
-----------------------------------------------------------------------------------------------


--DELETE FROM USER_SDO_GEOM_METADATA WHERE TABLE_NAME = '#TABLE#';

INSERT INTO USER_SDO_GEOM_METADATA (TABLE_NAME, COLUMN_NAME, DIMINFO, SRID)
VALUES ('#TABLE#', 'GEOM', SDO_DIM_ARRAY(SDO_DIM_ELEMENT('X', 594000, 964000, 0.005),SDO_DIM_ELEMENT('Y', 6987000, 7165000, 0.005)), 2154);

COMMIT;

-----------------------------------------------------------------------------------------------
----------------------------------- Index spatial ---------------------------------------------
-----------------------------------------------------------------------------------------------

CREATE INDEX #TABLE#_SIDX
ON #TABLE#(GEOM)
INDEXTYPE IS MDSYS.SPATIAL_INDEX
PARAMETERS('sdo_indx_dims=2, layer_gtype=#MULTIPOLYGON#, tablespace=INDX_#G_ADT#, work_tablespace=DATA_TEMP');

-----------------------------------------------------------------------------------------------
--------------------------------- Gestion des droits ------------------------------------------
-----------------------------------------------------------------------------------------------

GRANT SELECT ON #TABLE# TO G_ADT_DSIG_ADM;


-----------------------------------------------------------------------------------------------
----------------------------- Séquence pour clé primaire --------------------------------------
-----------------------------------------------------------------------------------------------

--SELECT MAX(OBJECTID) FROM #TABLE#;

CREATE SEQUENCE S_#TABLE# INCREMENT BY 1 START WITH #1# NOCACHE;

CREATE OR REPLACE TRIGGER B_IXX_#TABLE#
BEFORE INSERT ON #TABLE# FOR EACH ROW
BEGIN
  :new.OBJECTID := S_#TABLE#.nextval;
END;
/

-----------------------------------------------------------------------------------------------
----------------------------------- Création d'index ------------------------------------------
-----------------------------------------------------------------------------------------------

CREATE #UNIQUE# INDEX #TABLE#_#CHAMP#_IDX ON #TABLE#("#CHAMP#") TABLESPACE "INDX_#G_ADT#";


-----------------------------------------------------------------------------------------------
--------------------------------- Ajout d'un commentaire --------------------------------------
-----------------------------------------------------------------------------------------------


COMMENT ON TABLE #TABLE# IS '#COMMENT#';

-----------------------------------------------------------------------------------------------
----------------------------- Ajout d'un commentaire de champ ---------------------------------
-----------------------------------------------------------------------------------------------


COMMENT ON COLUMN #TABLE#.#COLUMN# IS '#COMMENT#';


-----------------------------------------------------------------------------------------------
------------------------------- Ajout d'une clé étrangère -------------------------------------
-----------------------------------------------------------------------------------------------

ALTER TABLE #TABLE# ADD CONSTRAINT #TABLE#_#CHAMP#_FK FOREIGN KEY ("#COL#") REFERENCES #TABLE_REF#("#COL#") /*ON DELETE CASCADE/SET NULL*/;


-----------------------------------------------------------------------------------------------
----------------------------- Ajout d'une contrainte unique -----------------------------------
-----------------------------------------------------------------------------------------------

ALTER TABLE #TABLE# ADD CONSTRAINT #TABLE#_#CHAMP#_UQ UNIQUE ("#COL#");

-----------------------------------------------------------------------------------------------
--------------------------------- Ajout d'une colonne -----------------------------------------
-----------------------------------------------------------------------------------------------

ALTER TABLE #TABLE# ADD #COL# #TYPECOL#;

-----------------------------------------------------------------------------------------------
------------------------------ Suppression d'une colonne --------------------------------------
-----------------------------------------------------------------------------------------------

ALTER TABLE #TABLE# DROP COLUMN #COL#;

-----------------------------------------------------------------------------------------------
------------------------------- Suppression d'une table ---------------------------------------
-----------------------------------------------------------------------------------------------

DROP TABLE #TABLE# CASCADE CONSTRAINTS;
DROP SEQUENCE S_#TABLE#;
DELETE FROM USER_SDO_GEOM_METADATA WHERE TABLE_NAME = '#TABLE#';